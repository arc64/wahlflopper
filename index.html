<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <title>Wahlflopper</title>
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">

	<!-- Optional theme -->
	<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-theme.min.css">

	<link rel="stylesheet" href="css/style.css" type="text/css"
	medium="screen" />

	<style>
		.jumbotron h1 {
			font-size: 38px;
		}
  		
  		#sortable li { }
  
  		.row {
  			margin-left: -6px;
  		}
  	/*	.video {
  			-moz-grab: ;
  		}*/
	</style>
  <!-- Latest compiled and minified JavaScript -->

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="../../assets/js/html5shiv.js"></script>
      <script src="../../assets/js/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
     <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Wahlflopper</a>
        </div>
        
      </div>
    </div>

    <div class="jumbotron">
      <div class="container">
      	<div class="page-header">
  			<h1>Remix your election defeat videos here <small>BTW13</small></h1>
		</div>
        <div class="panel panel-default">
		  <div class="panel-heading">Mixer</div>
		  <div class="panel-body mixer">
		  	<div class="row">
		    	<ul id="sortable" class="list-unstyled list-inline">
		    	</ul>
	    	</div>
	    	<a data-toggle="modal" href="#myModal" class="btn-success btn-lg glyphicon glyphicon-play pull-right"></a>
		  </div>
		</div>
      </div>
    </div>

    <div class="videos container">

      <!-- Example row of columns -->
      <div class="row">
        <div class="col-lg-4 picker">
          
        </div>
      </div>
      <hr>

      <footer>
        <p>&copy; Company 2013</p>
      </footer>
    </div> <!-- /container -->
    <script src="./vendor/mustache.js"></script>
	<!-- todo: boot load videos 
			drag and drop
	-->
	
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="http://code.jquery.com/jquery.js"></script>
    <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

    <script>
    $(function() {

    // some hairy user interaction
	    // $( ".draggable" ).draggable();
	    // $( "#droppable" ).droppable({
	    //   drop: function( event, ui ) {
	    //     $( this )
	    //       .addClass( "panel-success" );
	    //   }
	    // });
  
  

  		// data for videos
    	var inMixer = {
    	'items':[{
    	  'id':1,	
		  'title': "OMG",
		  'thumb': "path"
		}, {
		  'id':2,
		  'title': "OMG2",
		  'thumb': "path"
		}, {
		  'id':3,
		  'title': "OMG3",
		  'thumb': "path"
		}]};

		var videos = {'items':[{
    	  'id':1,	
		  'title': "OMG",
		  'thumb': "path"
		}, {
		  'id':2,
		  'title': "OMG2",
		  'thumb': "path"
		}, {
		  'id':3,
		  'title': "OMG3",
		  'thumb': "path"
		}, {
		  'id':4,
		  'title': "OMG4",
		  'thumb': "path"
		}
		]};

		// some method madness
		function removeItemFromMixer(id) {
			inMixer['items'] = $.grep(inMixer['items'], function(e){ return e.id != id; });
			$('body').data('videoid', id).removeClass('inMixer');
    	}

    	function addItemToMixer(id, item, index) {
    		inMixer['items'].splice(index, 0, item);
    		$('body').data('videoid', id).addClass('inMixer');
    	}

    	function getItem(id) {
    		return $.grep(inMixer['items'], function(e){ return e.id == id; });
    	}

    	// templates
		var videoTemplate = ['{{#items}}<li data-videoid="{{id}}" class="video col-2 col-sm-2 col-lg-2">',
			'<div class="panel panel-default">',
		        '<div class="panel-heading">',
		        '<button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>',
		          '<h3 class="panel-title"><h3></h3>',
		          
				'</div>',
		        '<div class="panel-body">',
		          '<a href="#" class="thumbnail">',
				      '<img data-src="holder.js/138%x180" alt="...">',
				   '</a>',
		        '</div>',
	      	'</div>',
	    '</li>{{/items}}'].join('');


	    var modelTemplate = [
	    '<!-- Modal -->',
		'<div class="modal fade">',
		'<div class="modal-dialog">',
		'<div class="modal-content">',
		'<div class="modal-header">',
		'<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>',
		'<h4 class="modal-title">{{title}}</h4>',
		'</div>',
		'<div class="modal-body">',
		'{{embed}}',
		'</div>',
		'<div class="modal-footer">',
		'<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>',
		'<button type="button" class="btn btn-primary">Save changes</button>',
		'</div>',
		'</div><!-- /.modal-content -->',
		'</div><!-- /.modal-dialog -->',
		'</div><!-- /.modal -->'
    	].join('');

    	var pickerTemplate = '{{#items}}<div class="item col-4 col-sm-4 col-lg-4" data-videoid={{id}}><h3>{{title}}</h3><img src="{{thumb}}" /><a href="#" type="button" class="btn btn-primary add">Add to remix</a></div>{{/items}}';

	    function renderMixer(){
	    	$('.mixer #sortable').html(Mustache.render(videoTemplate, inMixer));
	    	return;
	    }

	    function renderModel(){
	    	var video = 0;// todo: popcorn 
	    	$('.body').append(Mustache.render(modelTemplate, video));
	    	return;
	    }

		function renderPicker(){
			$('.picker').append(Mustache.render(pickerTemplate, videos));
		}

		// getting down to business
		// render some stuff
		renderMixer(); 
		renderPicker();
		//renderModal();

		// event heaven
		// $('.videos').html(videos);

		$('.mixer').delegate( ".close", "click", function(e) {
			vId = $(this).closest('.video').data('videoid');
			removeItemFromMixer(vId); 
		 	renderMixer(); 
		 	//updateURI();
		});

		$('.picker').delegate( ".add", "click", function(e) {
			vId = $(this).closest('.video').data('videoid');
			console.log(videos['items']);
			//todo: don't need to do this, just look it up
			//addItemToMixer(vId, videos['items'][vId], inMixer['items'].length); 
		 	//renderMixer(); 

		 	//updateURI();
		});

		// $('.glyphicon-play').click(function(){
		// 	//var urli = //resolve items;
		// 	// open modal and play video

		// });

// todo: smallify for mobile
// todo: add items from list
// todo: create list
// todo: cursor to grab / plus state indicator
// todo: hash for url
// todo: remix or share
// todo: make shit fade in and show user where they are
		$( "#sortable" ).sortable({
      		placeholder: "video",
  			stop: function(event, ui) {
  				var id = ui.item.data('videoid');
  				var item = getItem(id);
  				removeItemFromMixer(id);
  				addItemToMixer(id, item[0], ui.item.index());
		    }
    	});
	});
    </script>
  </body>
</html>